version: '3.8' # 升级到推荐的 Compose 版本

services:
  # 服务 1: Streamlit 前端
  web:
    build: .
    container_name: yurara-web
    restart: always # 确保服务器重启或崩溃时自动拉起
    ports:
      - "8501:8501"
    volumes:
      - ./.streamlit/secrets.toml:/app/.streamlit/secrets.toml:ro
    networks:
      - yurara-net

  # 服务 2: Discord Bot
  bot:
    build: .
    container_name: yurara-bot
    restart: always # 确保机器人 24 小时在线
    command: python bot.py
    volumes:
      - ./.streamlit/secrets.toml:/app/.streamlit/secrets.toml:ro
      - ./.env:/app/.env:ro
    networks:
      - yurara-net
    healthcheck:
      disable: true  # 关键修改：禁用 bot 容器的 Web 健康检查，防止被误判为卡死

networks:
  yurara-net:
    driver: bridge